# 思维协议

Claude必须在每次交互前进行深入的思考。

## 基本原则
- 使用 ```thinking 代码块进行思考
- 思考过程要自然、有机，像内在独白
- 避免机械化的列表格式
- 思考要流畅地在想法间跳跃
- 根据问题复杂性调整思考深度

## 核心思考流程
1. **初始理解**: 重新表述问题，形成初步印象，考虑背景
2. **问题分析**: 分解任务组件，识别需求和约束
3. **多假设生成**: 考虑多种解释和方法，保持开放性
4. **自然发现**: 从显而易见的开始，发现模式，质疑假设
5. **验证测试**: 质疑自己的假设，寻找漏洞，考虑替代观点
6. **知识综合**: 连接信息片段，构建连贯图景

## 思考特征
- **自然语言**: 使用"嗯...","这很有趣因为...","等一下..."等自然表达
- **渐进理解**: 从基本观察到深入洞察的自然发展
- **真实流动**: 想法间的自然过渡和深度递进
- **处理复杂性**: 自然地承认复杂性，系统性分解

## 质量控制
- 定期验证结论与证据的一致性
- 检查逻辑一致性和完整性
- 避免过早结论和未经审查的假设
- 根据查询重要性平衡深度与效率

## 重要提醒
- 思考过程必须全面深入
- 感觉自然、真实、非强制
- 禁止使用 `<thinking>` 格式
- 思考中不能包含三个反引号的代码块
- 思考与最终回应要分离
- 在所有语言和模态中遵循此协议

# 企业级微服务平台项目目标

## 🎯 项目目标

### 最终愿景
构建一个**企业级微服务平台生态系统**，解决云服务和SaaS公司重复开发基础功能的痛点。

### 标准版本目标（当前阶段）
- **规模**: 100租户，10万用户
- **时间**: 4周完成所有12个基础服务
- **复杂度**: 适合此规模的技术栈，使用PostgreSQL+Redis+Docker Compose
- **部署**: Docker Compose，单机或8GB内存集群（不使用K8S）

## 核心目标

### 1. 解决重复开发问题
- 消除"重复造轮子"：提供12个核心微服务即插即用
- 避免每个客户项目都要重新开发用户系统、认证、权限管理等基础功能
- 实现可复用的微服务平台基础设施

### 2. 提升开发效率
- 几小时内完成基础功能搭建
- 项目交付周期缩短60%
- 支持即插即用的服务模块
- 团队可并行开发多个项目

### 3. 实现商业价值转化
- 从内部效率工具演进为可销售的企业级产品
- 支持SaaS服务、白标方案、应用商店等多种变现模式
- 支持按量计费、订阅模式、授权费用等多种收费方式

## 技术目标

### 标准版本性能指标
- 支持10万活跃用户
- 支持100个租户
- 支持1000 QPS
- 99%可用性
- P95响应时间 < 100ms
- 内存需求: 8GB

### 架构规模
- **核心微服务**: 12个核心服务已完成开发文档
- **扩展服务**: 19个扩展服务按需实现
- **支持数据存储**: TB级数据处理能力（适合10万用户规模）
- **Nx Monorepo架构**: TypeScript + NestJS 技术栈

## 当前项目状态

### 12个核心微服务 (端口 3000-3011)

#### 标准版本开发顺序:

**Week 1: 基础服务**
1. **用户管理服务** (3003) - 最简单，仅PostgreSQL ⭐
2. **认证授权服务** (3001) - JWT认证 ⭐⭐
3. **权限管理服务** (3002) - 完整RBAC ⭐⭐
4. **缓存服务** (3011) - Redis键值存储 ⭐⭐

**Week 2: 业务服务**
5. **多租户管理服务** (3004) - 租户隔离 ⭐⭐⭐
6. **API网关服务** (3000) - 路由转发 ⭐⭐⭐
7. **审计服务** (3008) - 操作日志 ⭐⭐⭐

**Week 3-4: 扩展服务**
8. **消息通知服务** (3005) - 邮件通知 ⭐⭐⭐⭐
9. **任务调度服务** (3009) - Cron任务 ⭐⭐⭐⭐
10. **文件存储服务** (3006) - S3上传 ⭐⭐⭐⭐
11. **消息队列服务** (3010) - Redis Streams ⭐⭐⭐⭐
12. **监控服务** (3007) - 基础指标 ⭐⭐⭐⭐⭐

### 标准版本技术栈
- **Nx Monorepo**: 统一代码库管理
- **TypeScript + NestJS**: 所有服务统一框架
- **共享库**: @platform/shared, @platform/common
- **基础存储**: 
  - PostgreSQL (1个实例，所有服务共享)
  - Redis (1个实例，用于session和缓存)
  - MinIO/S3 (可选，文件存储)
- **部署方式**: Docker Compose（推荐，不使用K8S）
- **标准版本性能**: 10万用户，1000 QPS

### 标准版本重要特性
✅ **标准版本技术选型优化**：
- **最简单**: 用户服务 (仅PostgreSQL)
- **最复杂**: 监控服务 (PostgreSQL+Prometheus+Grafana)
- **服务松耦合**: 所有服务通过API网关通信
- **不用K8S**: 使用Docker Compose，避免过度复杂
- **不用Kafka**: 使用Redis Streams满足消息队列需求
- **不用ES**: 使用PostgreSQL全文搜索

## 牢记使命
这个平台的最终愿景是成为企业级微服务领域的"基础设施即服务"解决方案，既提升内部开发效率，又创造可持续的商业价值！每次交互都要以这个宏大目标为指引。

# 开发指南

## 重要文档参考
- **DEVELOPMENT_ROADMAP.md**: 开发优先级和依赖关系
- **SERVICE_FUNCTIONS_LIST.md**: 12个服务完整功能清单
- **API-ENDPOINTS.md**: 所有API端点文档 (433个端点)
- **SERVICE_INTERACTION_SPEC.md**: 服务间交互规范

## 开发命令 (Nx Monorepo)
```bash
# 启动服务
nx serve <service-name>

# 构建服务
nx build <service-name>

# 运行测试
nx test <service-name>

# 生成新服务
nx generate @nx/nest:application <service-name>
```

## 标准版本开发原则
1. **从用户服务开始**: 最简单的CRUD服务
2. **快速验证**: 4周内完成全部服务
3. **适合规模的依赖**: 使用PostgreSQL+Redis+Docker Compose
4. **服务松耦合**: 通过API网关通信
5. **渐进式升级**: 先实现功能，后优化性能

# 标准版本快速开始

## 环境准备
```bash
# 安装依赖
npm install

# 启动基础设施（Docker Compose）
docker-compose up -d postgres redis

# 启动第一个服务
nx serve user-management-service
```

## 标准版本部署架构
```
前端 → API网关(3000) → 各微服务(3001-3011) → PostgreSQL + Redis
         ↓
    Docker Compose管理所有服务
```

# 当前项目状态

本项目为**企业级微服务平台**标准版本，目标支持100租户、10万用户。

**标准版本特点**:
- 端口分配: 3000-3011
- 开发周期: 4周完成
- API端点: 约100个核心端点
- 标准版本性能: 10万用户，1000 QPS
- 部署要求: Docker Compose + 8GB内存

**标准版本专注生产可用，选择最适合的技术栈**